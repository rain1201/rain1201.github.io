<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>aBlog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="aBlog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="aBlog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="aBlog"><meta property="og:url" content="https://blog.hypxs.eu.org/"><meta property="og:site_name" content="aBlog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.hypxs.eu.org/img/og_image.png"><meta property="article:author" content="Rye Song"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://blog.hypxs.eu.org/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hypxs.eu.org"},"headline":"aBlog","image":["https://blog.hypxs.eu.org/img/og_image.png"],"author":{"@type":"Person","name":"Rye Song"},"publisher":{"@type":"Organization","name":"aBlog","logo":{"@type":"ImageObject","url":"https://blog.hypxs.eu.org/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="aBlog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-09T08:26:48.000Z" title="2024/5/9 16:26:48">2024-05-09</time>发表</span><span class="level-item"><time dateTime="2024-05-09T08:50:35.533Z" title="2024/5/9 16:50:35">2024-05-09</time>更新</span><span class="level-item">16 分钟读完 (大约2471个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/">剪刀石头布dapp开发</a></p><div class="content"><h2 id="1-实验任务和需求"><a href="#1-实验任务和需求" class="headerlink" title="1.  实验任务和需求"></a>1.  实验任务和需求</h2><p>开发一个剪刀石头布的智能合约，实现以下功能或特性：</p>
<p>（1）实现剪刀石头布游戏的基本逻辑，正确判断游戏结果。</p>
<p>（2）将玩家提交的信息加密（暂且将取hash作为加密）储存在区块中，尽可能避免作弊。</p>
<p>（3）尽可能保证合约在输入非法的情况下仍能运行。</p>
<p>（4）使合约具有一定的可复用性。</p>
<p>并开发与之配套的前端程序，使合约易于使用。</p>
<h2 id="2-概要设计（实验思路）"><a href="#2-概要设计（实验思路）" class="headerlink" title="2.  概要设计（实验思路）"></a>2.  概要设计（实验思路）</h2><p>（1）使用bet函数判断用户能否加入游戏，如果可以则保存用户的地址与提交的hash</p>
<p>（2）使用reveal函数接收用户对自己选择的披露并进行校验</p>
<p>（3）使用getreward函数给用户发放奖励</p>
<h2 id="3-详细设计（关键算法）"><a href="#3-详细设计（关键算法）" class="headerlink" title="3.  详细设计（关键算法）"></a>3.  详细设计（关键算法）</h2><p>（1）全局数据结构：</p>
<p>address payable[2] player;&#x2F;&#x2F;当前玩家地址</p>
<p>bytes32[2] p;&#x2F;&#x2F;hash加密下注情况</p>
<p>uint[2] value;&#x2F;&#x2F;下注金额</p>
<p>uint8[2] chosed;&#x2F;&#x2F;玩家选择手势，1：剪刀 2石头 3布</p>
<p>uint8 numberOfPlayer;&#x2F;&#x2F;当前玩家数量</p>
<p>uint8 winner;&#x2F;&#x2F;2：未决定，3：平局，1：玩家1，0：玩家0</p>
<p>uint timeout;&#x2F;&#x2F;超时时间</p>
<p>uint finishtime;&#x2F;&#x2F;玩家完成提交hash时间</p>
<p>  uint MinValue;&#x2F;&#x2F;最小下注金额</p>
<p>（2）只有当玩家数量不足或上一局玩家超时过长（4倍timeout）时，bet函数才会允许新玩家加入。如果情况属于后者，则还会将下注金额分别退还给上一局两位玩家，并进行重置。同时，bet函数不允许玩家对提交内容进行修改，与现实较为一致。</p>
<p>（3）reveal函数对输入取hash，并与bet保存的hash比较，如果一致，则储存输入。</p>
<p>（4）getwinner函数判断胜者，此函数中硬编码了所有合法的情况，并会将其他情况判定为平局。</p>
<p>（5）getreward函数首先判断是否达到获取奖励的条件，即是否游戏双方都完成了披露、调用者是否为胜者，然后进行先更改余额再进行转账并重置合约。如果平局，则双方可分别拿回自己的下注。如果超时且仅有一方披露，则认为该方为胜者。如果超时且两方均未披露，则认为平局。</p>
<p>（6）reset用于重置合约状态，设置为internal以防止外部恶意调用</p>
<p>generatehash用于创建执行bet函数所需的hash，设置为pure，执行情况不会被记录</p>
<p>getinfo用于获取合约状态，主要用于前端展示，设置为view</p>
<p>user用于获取玩家编号（0，1），非当前玩家调用会导致错误</p>
<h2 id="4-代码实现"><a href="#4-代码实现" class="headerlink" title="4.  代码实现"></a>4.  代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line">/// @title 猜拳合约</span><br><span class="line">/// @author sry</span><br><span class="line">/// @dev 仅在有限的测试中没有发生错误</span><br><span class="line">contract putETH &#123;</span><br><span class="line">    address payable[2] player;//玩家地址</span><br><span class="line">    bytes32[2] p;//hash加密下注情况</span><br><span class="line">    uint[2] value=[0,0];//下注金额</span><br><span class="line">    uint8[2] chosed=[0,0];//1：剪刀 2石头 3布</span><br><span class="line">    uint8 numberOfPlayer = 0;</span><br><span class="line">    uint8 winner=2;//2：未决定，3：平局，1：玩家1，0：玩家0</span><br><span class="line">    uint timeout=30 minutes;</span><br><span class="line">    uint finishtime=now;</span><br><span class="line">    uint MinValue=1 wei;</span><br><span class="line">    /// @notice 用户下注</span><br><span class="line">    /// @param hash 用户下注信息,传入应当为keccak256(abi.encodePacked(uint8 choose,uint secret))</span><br><span class="line">    /// @return hash</span><br><span class="line">    function bet(bytes32 hash) public payable returns(bytes32)&#123;</span><br><span class="line">        if(now&gt;=finishtime+4*timeout &amp;&amp; msg.sender!=player[0]&amp;&amp;msg.sender!=player[1])&#123;</span><br><span class="line">            uint refund;</span><br><span class="line">            refund=value[0];</span><br><span class="line">            value[0]=0;</span><br><span class="line">            player[0].transfer(refund);</span><br><span class="line">            refund=value[1];</span><br><span class="line">            value[1]=0;</span><br><span class="line">            player[1].transfer(refund);</span><br><span class="line">            reset();</span><br><span class="line">        &#125;</span><br><span class="line">        if (numberOfPlayer&gt;=2)revert();</span><br><span class="line">        if (msg.value&lt;MinValue)revert();</span><br><span class="line">        if (numberOfPlayer==1 &amp;&amp; msg.sender==player[0])revert();</span><br><span class="line">        numberOfPlayer=numberOfPlayer+1;</span><br><span class="line">        value[numberOfPlayer-1]=msg.value;</span><br><span class="line">        p[numberOfPlayer-1]=hash;</span><br><span class="line">        player[numberOfPlayer-1]=msg.sender;</span><br><span class="line">        finishtime=now;</span><br><span class="line">        return hash;</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 用户披露下注情况</span><br><span class="line">    /// @param choose 用户选择的手势</span><br><span class="line">    /// @param secret 用户自定密钥</span><br><span class="line">    /// @return choose</span><br><span class="line">    function reveal(uint8 choose,uint secret) external returns(uint)&#123;</span><br><span class="line">        uint8 user=user(msg.sender);</span><br><span class="line">        if (p[user]==keccak256(abi.encodePacked(choose, secret))) &#123;</span><br><span class="line">            chosed[user]=choose;</span><br><span class="line">        &#125;else revert();</span><br><span class="line">        return choose;</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 获取奖励，平局分别取回</span><br><span class="line">    /// @return reward 奖励值</span><br><span class="line">    function GetReward() external returns(uint)&#123;</span><br><span class="line">        uint reward=0;</span><br><span class="line">        if((chosed[0]==0 || chosed[1]==0) &amp;&amp; now&lt;finishtime+timeout)&#123;</span><br><span class="line">            revert();</span><br><span class="line">            &#125;</span><br><span class="line">        if(now&gt;=finishtime+timeout &amp;&amp; (chosed[0]==0 || chosed[1]==0))&#123;</span><br><span class="line">            uint8 user=user(msg.sender);</span><br><span class="line">            if(chosed[0]==0 &amp;&amp; chosed[1]==0)&#123;</span><br><span class="line">            winner=3;</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">            if(chosed[user]==0)revert();</span><br><span class="line">            reward=value[0]+value[1];</span><br><span class="line">            value[0]=0;</span><br><span class="line">            value[1]=0;</span><br><span class="line">            player[user].transfer(reward);</span><br><span class="line">            reset();</span><br><span class="line">            return reward;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(winner==2)winner=getwinner();</span><br><span class="line">        require(winner!=2);</span><br><span class="line">        if(winner!=3)&#123;</span><br><span class="line">            if(msg.sender!=player[winner])revert();</span><br><span class="line">            reward=value[0]+value[1];</span><br><span class="line">            value[0]=0;</span><br><span class="line">            value[1]=0;</span><br><span class="line">            player[winner].transfer(reward);</span><br><span class="line">            reset();</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            uint8 user=user(msg.sender);</span><br><span class="line">            reward=value[user];</span><br><span class="line">            value[user]=0;</span><br><span class="line">            msg.sender.transfer(reward);</span><br><span class="line">            if(value[0]==0 &amp;&amp; value[1]==0)reset();</span><br><span class="line">        &#125;</span><br><span class="line">        return reward;</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 计算胜者</span><br><span class="line">    /// @dev reveal()并没有检查choose的值是否合法，在此函数中，不合法的输入会被判定为平局</span><br><span class="line">    /// @return user 胜者编号</span><br><span class="line">    function getwinner() public view returns(uint8)&#123;</span><br><span class="line">        if(chosed[0]==chosed[1])&#123;</span><br><span class="line">            return 3;</span><br><span class="line">            &#125;</span><br><span class="line">        else if((chosed[0]==2 &amp;&amp; chosed[1]==1) || (chosed[0]==1 &amp;&amp; chosed[1]==3) || (chosed[0]==3 &amp;&amp; chosed[1]==2))&#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        else if((chosed[1]==2 &amp;&amp; chosed[0]==1) || (chosed[1]==1 &amp;&amp; chosed[0]==3) || (chosed[1]==3 &amp;&amp; chosed[0]==2))&#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">        return 3;</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 重置</span><br><span class="line">    function reset() internal &#123;</span><br><span class="line">        numberOfPlayer=0;</span><br><span class="line">        chosed[0]=0;</span><br><span class="line">        chosed[1]=0;</span><br><span class="line">        winner=2;</span><br><span class="line">        finishtime=now;</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 获取用户编号</span><br><span class="line">    /// @dev 调用用户非当前玩家会导致revert</span><br><span class="line">    /// @param t 用户地址</span><br><span class="line">    /// @return user 用户编号</span><br><span class="line">    function user(address t) internal view returns(uint8)&#123;</span><br><span class="line">        if(t==player[0])&#123;return 0;&#125;</span><br><span class="line">        else if(t==player[1])&#123;return 1;&#125;</span><br><span class="line">        else revert();</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 获取当前信息</span><br><span class="line">    /// @return player,value,chosed</span><br><span class="line">    function GetInfo() public view returns(address,address,uint,uint,uint8,uint8)&#123;</span><br><span class="line">        return (player[0],player[1],value[0],value[1],chosed[0],chosed[1]);</span><br><span class="line">    &#125;</span><br><span class="line">    /// @notice 生成hash</span><br><span class="line">    /// @dev 函数声明为pure，执行情况不会被记录</span><br><span class="line">    /// @param choose 选择手势</span><br><span class="line">    /// @param secret 密码</span><br><span class="line">    /// @return x 生成的hash</span><br><span class="line">    function GenerateHash(uint8 choose,uint secret) pure public returns(bytes32)&#123;</span><br><span class="line">        bytes32 x;</span><br><span class="line">        x=keccak256(abi.encodePacked(choose,secret));</span><br><span class="line">        return x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="comment">/*--预设--*/</span> </span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">body</span> &#123; <span class="attribute">padding</span>:<span class="number">0px</span>;<span class="attribute">margin</span>: <span class="number">0px</span>; &#125; </span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#lyrow</span>, <span class="selector-id">#lyrow</span> <span class="selector-tag">input</span>, <span class="selector-id">#lyrow</span> <span class="selector-tag">textarea</span> &#123; <span class="attribute">font-size</span>:<span class="number">12px</span>;<span class="attribute">font-family</span>: <span class="string">&#x27;Microsoft YaHei&#x27;</span>, <span class="string">&#x27;微软雅黑&#x27;</span>, MicrosoftJhengHei, <span class="string">&#x27;华文细黑&#x27;</span>, STHeiti, MingLiu; &#125; </span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#lyrow</span> &#123; <span class="attribute">height</span>:<span class="number">100vh</span>;<span class="attribute">width</span>: <span class="number">100vw</span>; &#125; </span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#lyrow</span> <span class="selector-tag">div</span> &#123; <span class="attribute">min-height</span>: <span class="number">18px</span>;  &#125; </span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#lyrow</span> <span class="selector-tag">input</span>, <span class="selector-id">#lyrow</span> <span class="selector-tag">textarea</span> &#123; <span class="attribute">border</span>:<span class="built_in">rgb</span>(<span class="number">235</span>, <span class="number">235</span>, <span class="number">235</span>) <span class="number">1px</span> solid;<span class="attribute">border-radius</span>: <span class="number">3px</span>;<span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">8px</span>;<span class="attribute">outline</span>: <span class="number">0</span>; &#125; </span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#lyrow</span> <span class="selector-tag">input</span><span class="selector-pseudo">:hover</span>, <span class="selector-id">#lyrow</span> <span class="selector-tag">textarea</span><span class="selector-pseudo">:hover</span> &#123; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#6bc1f2</span>; &#125; </span></span><br><span class="line"><span class="language-css">		<span class="comment">/*--编辑--*/</span> </span></span><br><span class="line"><span class="language-css">		</span></span><br><span class="line"><span class="language-css">		</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lyrow&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;连接metamask&quot;</span> <span class="attr">id</span>=<span class="string">&quot;connect&quot;</span> &gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">span</span> &gt;</span>选择手势：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;select&quot;</span> <span class="attr">id</span>=<span class="string">&quot;choose&quot;</span> &gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>剪刀<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>石头<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>布<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">select</span>&gt;</span>     </span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span> &gt;</span>选择账号：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;select&quot;</span> <span class="attr">id</span>=<span class="string">&quot;acc&quot;</span> &gt;</span></span><br><span class="line">		    </span><br><span class="line">		<span class="tag">&lt;/<span class="name">select</span>&gt;</span>     </span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span> &gt;</span>下注金额(eth,支持小数)：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span> <span class="attr">oninput</span>=<span class="string">&quot;value=value.replace(/[^\d.]/g,&#x27;&#x27;)&quot;</span> <span class="attr">id</span>=<span class="string">&quot;val&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span> &gt;</span>随机数：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span> <span class="attr">oninput</span>=<span class="string">&quot;value=value.replace(/[^\dabcdefx]/g,&#x27;&#x27;)&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ran&quot;</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;获取当前状态&quot;</span> <span class="attr">id</span>=<span class="string">&quot;getinfo&quot;</span> &gt;</span>    </span><br><span class="line">		    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下注&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bet&quot;</span> &gt;</span>    </span><br><span class="line">		    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;披露下注情况&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reveal&quot;</span> &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查看结果&quot;</span> <span class="attr">id</span>=<span class="string">&quot;getwinner&quot;</span> &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;获取奖励&quot;</span> <span class="attr">id</span>=<span class="string">&quot;getreward&quot;</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;player-content&quot;</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/web3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> account = <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">var</span> web3 = <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">const</span> address = <span class="string">&#x27;0xb92b82a94382b9110e8febBEd4AEfB7F3436a26F&#x27;</span>;<span class="comment">//&#x27;0xa7228a391b6B0E343C33F6aE5A511Eefaf540688&#x27;;//&#x27;0xd6C500DccEF6B65eF956B7446a405cbed4c47814&#x27; ;// 合约部署地址</span></span><br><span class="line">	<span class="keyword">var</span> contract =<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">var</span> choose=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">var</span> r=<span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">const</span> abi =[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint8&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;choose&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint8&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;secret&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;GenerateHash&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;bytes32&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;bytes32&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;GetInfo&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;address&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;address&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint8&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint8&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint8&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint8&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;GetReward&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;bytes32&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;hash&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;bytes32&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;bet&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;bytes32&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;bytes32&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;payable&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;getwinner&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint8&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint8&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&quot;constant&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;inputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint8&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;choose&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint8&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;secret&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: <span class="string">&quot;reveal&quot;</span>,</span><br><span class="line">		<span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">				<span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;payable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">];</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">handleAccountsChanged</span>(<span class="params">accounts</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> acc=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;acc&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (accounts.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Please connect to MetaMask.&#x27;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">			acc.<span class="property">innerHTML</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> a=<span class="number">0</span>; a&lt;accounts.<span class="property">length</span>;a++)&#123;</span><br><span class="line">				acc.<span class="property">innerHTML</span>+=<span class="string">`&lt;option value=&quot;<span class="subst">$&#123;accounts[a]&#125;</span>&quot;&gt;<span class="subst">$&#123;accounts[a]&#125;</span>&lt;/option&gt;\n`</span>;</span><br><span class="line">			&#125;;</span><br><span class="line">			account = acc.<span class="property">value</span>;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(account);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">changeaccount</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> acc=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;acc&quot;</span>);</span><br><span class="line">		account = acc.<span class="property">value</span>;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(account);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">connect</span>(<span class="params"></span>)&#123;</span><br><span class="line">		ethereum</span><br><span class="line">		        .<span class="title function_">request</span>(&#123; <span class="attr">method</span>: <span class="string">&#x27;eth_requestAccounts&#x27;</span> &#125;)</span><br><span class="line">		        .<span class="title function_">then</span>(handleAccountsChanged)</span><br><span class="line">		        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">		            <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="number">4001</span>) &#123;</span><br><span class="line">		                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Please connect to MetaMask.&#x27;</span>);</span><br><span class="line">		            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		                <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">		            &#125;</span><br><span class="line">		        &#125;);</span><br><span class="line">		web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="variable language_">window</span>.<span class="property">web3</span>.<span class="property">currentProvider</span>);</span><br><span class="line">		contract= <span class="keyword">new</span> web3.<span class="property">eth</span>.<span class="title class_">Contract</span>(abi, address);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">bet</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> sel=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;choose&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> val=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> ran=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ran&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> hash;</span><br><span class="line">		web3.<span class="property">utils</span>.<span class="title function_">randomHex</span>(<span class="number">32</span>);</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title class_">GenerateHash</span>(sel.<span class="property">value</span>,<span class="built_in">parseInt</span>(ran.<span class="property">value</span>)).<span class="title function_">call</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">		hash=result;<span class="comment">//web3.utils.hexToAscii(result);</span></span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(hash);</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title function_">bet</span>(hash).<span class="title function_">send</span>(&#123;</span><br><span class="line">			<span class="attr">from</span>: account,<span class="attr">gasPrice</span>: <span class="string">&quot;1000000000&quot;</span>,<span class="attr">value</span>: <span class="title class_">String</span>(<span class="built_in">parseFloat</span>(val.<span class="property">value</span>)*<span class="number">1000000000000000000</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">		.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, receipt</span>) &#123;<span class="title function_">alert</span>(error,receipt);<span class="keyword">return</span>;&#125;)</span><br><span class="line">		.<span class="title function_">on</span>(<span class="string">&#x27;receipt&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">		sel.<span class="property">disabled</span>=<span class="literal">true</span>;</span><br><span class="line">		val.<span class="property">disabled</span>=<span class="literal">true</span>;</span><br><span class="line">		ran.<span class="property">disabled</span>=<span class="literal">true</span>;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">reveal</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> sel=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;choose&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> val=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> ran=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ran&quot;</span>);</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title function_">reveal</span>(sel.<span class="property">value</span>,<span class="built_in">parseInt</span>(ran.<span class="property">value</span>)).<span class="title function_">send</span>(&#123;<span class="attr">from</span>: account,<span class="attr">gasPrice</span>: <span class="string">&quot;1000000000&quot;</span>&#125;)</span><br><span class="line">		.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, receipt</span>) &#123;<span class="title function_">alert</span>(error,receipt);<span class="keyword">return</span>;&#125;)</span><br><span class="line">		.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">		&#125;);</span><br><span class="line">		sel.<span class="property">disabled</span>=<span class="literal">false</span>;</span><br><span class="line">		val.<span class="property">disabled</span>=<span class="literal">false</span>;</span><br><span class="line">		ran.<span class="property">disabled</span>=<span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">getreward</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> sel=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;choose&quot;</span>);</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title class_">GetReward</span>().<span class="title function_">send</span>(&#123;<span class="attr">from</span>: account,<span class="attr">gasPrice</span>: <span class="string">&quot;1000000000&quot;</span>&#125;)</span><br><span class="line">		.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, receipt</span>) &#123;<span class="title function_">alert</span>(error,receipt);<span class="keyword">return</span>;&#125;)</span><br><span class="line">		.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">getinf</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> res=[<span class="string">&quot;have not revealed&quot;</span>,<span class="string">&quot;剪刀&quot;</span>,<span class="string">&quot;石头&quot;</span>,<span class="string">&quot;布&quot;</span>];</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title class_">GetInfo</span>().<span class="title function_">call</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">		<span class="title function_">alert</span>(<span class="string">&quot;player 0:&quot;</span>+result[<span class="number">0</span>]+<span class="string">&quot;\n&quot;</span>+</span><br><span class="line">		<span class="string">&quot;player 1:&quot;</span>+result[<span class="number">1</span>]+<span class="string">&quot;\n&quot;</span>+</span><br><span class="line">		<span class="string">&quot;value 0:&quot;</span>+result[<span class="number">2</span>]+<span class="string">&quot;\n&quot;</span>+</span><br><span class="line">		<span class="string">&quot;value 1:&quot;</span>+result[<span class="number">3</span>]+<span class="string">&quot;\n&quot;</span>+</span><br><span class="line">		<span class="string">&quot;choose 0:&quot;</span>+res[<span class="built_in">parseInt</span>(result[<span class="number">4</span>])]+<span class="string">&quot;\n&quot;</span>+</span><br><span class="line">		<span class="string">&quot;choose 1:&quot;</span>+res[<span class="built_in">parseInt</span>(result[<span class="number">5</span>])]+<span class="string">&quot;\n&quot;</span></span><br><span class="line">		);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">getwinner</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> res=[<span class="string">&quot;player 0 wins&quot;</span>,<span class="string">&quot;player 1 wins&quot;</span>,<span class="string">&quot;have not decided&quot;</span>,<span class="string">&quot;draw/other situations&quot;</span>];</span><br><span class="line">		contract.<span class="property">methods</span>.<span class="title function_">getwinner</span>().<span class="title function_">call</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">		<span class="title function_">alert</span>(res[<span class="built_in">parseInt</span>(result)]);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	$(<span class="string">&quot;#connect&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, connect);</span><br><span class="line">	$(<span class="string">&quot;#getinfo&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, getinf);</span><br><span class="line">	$(<span class="string">&quot;#bet&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, bet);</span><br><span class="line">	$(<span class="string">&quot;#reveal&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, reveal);</span><br><span class="line">	$(<span class="string">&quot;#getwinner&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, getwinner);</span><br><span class="line">	$(<span class="string">&quot;#getreward&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, getreward);</span><br><span class="line">	$(<span class="string">&quot;#acc&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, changeaccount);</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ran&quot;</span>).<span class="property">value</span>=<span class="title class_">Web3</span>.<span class="property">utils</span>.<span class="title function_">randomHex</span>(<span class="number">32</span>);</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="5-测试方案"><a href="#5-测试方案" class="headerlink" title="5.  测试方案"></a>5.  测试方案</h2><p>创建两个账户模拟两个玩家进行游戏，注意完全模拟输赢和平局情况，并模拟一些非法输入或超时的情况。创建第三个账户，模拟非玩家调用情况。将合约部署至测试链，将前端部署至服务器，测试前端工作情况。</p>
<h2 id="6-测试过程"><a href="#6-测试过程" class="headerlink" title="6.  测试过程"></a>6.  测试过程</h2><p>先在remix vm中进行测试。</p>
<p>（secret的类型为uint256，实际前端会随机生成32byte作为secret，足够安全。为了测试方便使用较简单的secret）</p>
<p>生成hash：</p>
<p>​            <img src="/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91%5Cimage-20240509163504467-1715243708776-1.png" alt="image-20240509163504467">                   </p>
<p>下注及执行后情况：</p>
<p>​      </p>
<p><img src="/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91%5Cimage-20240509163530103.png" alt="image-20240509163530103"></p>
<img src="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/image-20240509163620232.png" class="" title="image-20240509163620232">

<img src="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/image-20240509163631509.png" class="" title="image-20240509163631509">



<p>披露：<img src="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/image-20240509163638081.png" class="" title="image-20240509163638081"></p>
   <img src="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/image-20240509163645465.png" class="" title="image-20240509163645465">

<p>对另一账号进行相似操作，得结果：</p>
 <img src="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/image-20240509163653572.png" class="" title="image-20240509163653572">





<p>（超时处理的效果难以展示，从略）</p>
<h2 id="7-结果分析"><a href="#7-结果分析" class="headerlink" title="7.  结果分析"></a>7.  结果分析</h2><p>在有限的测试中，合约和前端都正常工作。合约能够正确执行游戏逻辑，并具有一定的安全性和抵抗非法输入的能力。前端能够与合约恰当配合，具有一定的易用性。</p>
<h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8.  总结"></a>8.  总结</h2><p>本实验设计了一个剪刀石头布的智能合约，并配套开发了前端页面，且进行了相关测试，基本完成了实验的目标与需求。</p>
<p>但是受限于开发时间、开发条件等因素，本实验也存在许多可完善之处。例如合约中超时处理的逻辑可以进一步优化，合约整体可以进一步优化以节省gas，前端较为简陋，前端与合约的交互可以通过event而不一定是函数返回值。这些问题有待于进一步解决完善。</p>
<p>在此实验中，Microsoft Azure提供了托管前端的服务器资源、Cloudflare提供了域名解析与CDN服务、ethereum.org提供了智能合约的集成开发与测试环境、智谷提供了合约最终部署环境，在此一并向它们表示感谢。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-09T08:24:43.000Z" title="2024/5/9 16:24:43">2024-05-09</time>发表</span><span class="level-item"><time dateTime="2024-05-09T08:27:40.816Z" title="2024/5/9 16:27:40">2024-05-09</time>更新</span><span class="level-item">26 分钟读完 (大约3964个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/09/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%BB%BC%E8%BF%B0/">强化学习综述</a></p><div class="content"><p>摘 要   强化学习作为一种受到人类自然学习过程启发的机器学习方式，已经成为一种解决策略探索问题的主要方法。通过学习强化学习的基本概念与组成、分析相关常用算法的基本原理、展望前景与前沿挑战共三个方面概述分析强化学习，期望在完成作业的同时为对该领域一无所知的人提供有限的启发。</p>
<p><strong>关键词</strong>   强化学习；策略搜索；神经网络</p>
<p>A Review of Reinforcement Learning</p>
<p><strong>Abstract</strong>  Reinforcement learning, as a machine learning method inspired by the natural learning process of humans, has become a major approach for solving problems related to strategy exploration. By learning the basic concepts and components of reinforcement learning, analyzing the basic principles of commonly used algorithms, and looking forward to the prospects and frontier challenges, this article provides an overview and analysis of reinforcement learning, with the expectation of providing limited inspiration for those who know nothing about this field while completing the assignment.</p>
<p><strong>Key words</strong>  Reinforcement learning; Policy search; Neural networks</p>
<p> 在生物进化的过程中，物种的学习能力不断增强。而任何一个物种的学习，都离不开与自然环境的交互。他们在自然环境中进行行为的选择，根据不同行为选择获得不同的回报。再此过程中他们逐渐获得了对特定环境情况的判断能力，也就是习得了新技能。如果根据拉马克的用进废退理论，这种能力还会在亲子代间遗传，从而使整个种群不断进化。</p>
<p> 虽然以现代科学的视角来看，拉马克的观点存在一定的局限性，但这并不妨碍其观点为当代人工智能的研发提供灵感。强化学习过程便与生物在环境中进行交互式学习有异曲同工之妙。在计算过程中，强化学习试图尽可能提高自身与环境交互而产生的收益总量。强化学习会从过往训练过程中获取信息并对自身进行修正，以此提高下一次预测的预期收益。</p>
<p>1 强化学习基础概念</p>
<p>1．1  强化学习</p>
<p> 强化学习主要解决一个智能体如何在一个不确定的环境中通过与环境的交互而获得尽可能多的收益的问题。它通过收集环境信息，指导更好的动作。这种在交互中学习的方法被称为强化学习。</p>
<p>1．2  基本元素</p>
<p>1．2．1 环境与智能体</p>
<p>环境是智能体观察、感知、交互的外部系统。智能体处于环境中，能通过采取行动来改变环境。</p>
<p>1．2．2 状态与观察值</p>
<p>​    两者均描述环境。不同之处在于状态是对环境的完全描述，不会遗漏任何信息。而观察值可能是对环境的有限描述，可能仅包含环境的部分信息。</p>
<p>1．2．3 动作</p>
<p>​    不同的环境允许智能体进行不同的活动，其允许的有效动作的集合被称作动作空间，可分为离散动作空间和连续动作空间。</p>
<p>1．2．4 奖励</p>
<p>​    奖励是由环境给予智能体的反馈信号，是一个标量，可用于评价智能体在某一步采取动作的表现如何。</p>
<p>1．3  术语</p>
<p>1．3．1 策略</p>
<p>  策略用于根据当前状态决定下一步执行的动作，可以是确定的或随机的，分别表示为：</p>
<p>at&#x3D;μ(st)</p>
<p>at~π(st)</p>
<p>1．3．2 状态转移</p>
<p>用于衡量在当前环境和行动下，系统状态向某一状态转移的可能性。一般是随机的。可以使用状态密度函数表示：</p>
<p>p(s<code>| s, a)=P(S</code>&#x3D;s&#96; | S&#x3D;s, A&#x3D;a)</p>
<p>1．3．3 回报</p>
<p>  回报是对奖励的加权求和。因为未来的奖励具有不确定性，距现在越远的奖励不确定性越强。因此引入折扣率γ，减弱未来的奖励对当下回报计算的影响：</p>
<p>Ut&#x3D; Rt+γ2Rt+1+γ3Rt+2+……</p>
<p>1．3．4价值函数</p>
<p>  可分为状态价值函数和动作价值函数。前者在给定策略的情况下衡量当前当前状态的好坏；后者在给定策略和状态的情况下衡量某一动作的好坏。</p>
<p>2    强化学习算法</p>
<p>2．1 算法分类</p>
<p> 按照环境是否已知划分，强化学习算法可分为免模型学习和有模型学习。前者不会尝试模拟环境，而后者会通过模拟环境来预判采取某个行动会发生的情况。一般来说，环境是难以模拟的，所以主要研究无模型学习。</p>
<p> 按照学习方式划分，强化学习算法可分为在线策略和离线策略。前者必须由智能体与环境交互并学习；后者则可以观察其他个体与环境交互而进行学习。</p>
<p> 按照学习目标划分，强化学习算法可分为基于策略和基于价值。前者直接根据概率选择动作，后者选择价值较高的动作。两者可以进行结合</p>
<p>2．2 Q-Learning</p>
<p>2．2．1 概述</p>
<p> Q-Learning是一种基于表格而没有神经网络参与的算法。它通过每次尝试更新Q值表，并以此指导行动。</p>
<p>2．2．2 算法流程</p>
<p> 1．初始化动作价值函数Q(s,a)，其中s代表状态，a代表选择的动作。</p>
<p> 2．依照状态s根据Q及其他策略（例如ε贪婪策略）选择动作a</p>
<p> 3．执行动作a，观察当前状态s&#96;与收益r</p>
<p> 4．更新</p>
<p>Q(s,a)&#x3D;Q(s,a)+α[r+γmaxa<code> Q(s</code>,a&#96;)-Q(s,a)]</p>
<p>s&#x3D;s&#96;</p>
<p> 其中α为学习率, maxa<code> Q(s</code>,a&#96;)代表从下一动  作中预期获得的最大收益。</p>
<p> 5．重复2，3，4</p>
<p>2．2．3 ε贪婪策略</p>
<p> 在开始时，Q(s,a)被初始化的方式可能与最优解相差很远，这可能导致学习缓慢。因此，需要权衡随机探索与利用已有经验的程度。此时，可以使用ε贪婪策略。ε表示在某一步时使用随机行动的概率。</p>
<p> 开始时，将ε设定为1，即完全随机。这可以为Q函数的构建提供丰富的学习资源。随着训练的进行，Q函数变得更为准确，此时可以逐步缩小ε，更多地由Q函数决定采取的行动。</p>
<p>2．2．4 Q值表</p>
<p> Q的函数值是由s与a共同决定的，且在Q-Learning中，s与a都是离散的。这使得我们可以通过一张二维表格将Q函数完整表示。表格中的一维是环境的所有状态，另一维是能够采取的动作，中间则为Q值。</p>
<p> 事实上，通过Q函数选择动作的过程就是在Q值表中选取当前状态对应的一行，找到该行中最大的Q值，并采取其列对应的动作。</p>
<p>2．3 Deep Q Network</p>
<p>2．3．1 概述</p>
<p> Q-Learning使用Q值表来保存Q值，这对于有较多状态的环境或连续的动作是不现实的。在DQN中，神经网络替代了Q值表，接受状态s与动作a并给出预测的Q值。</p>
<p>2．3．2 存在问题</p>
<p> 1．一个极小的变化可能引起对动作选择的很大影响。</p>
<p> 2．对于连续动作，选择最大的Q值仍比较困难。</p>
<p> 3．无法学习到随机策略。</p>
<p>2．4 Policy Gradient</p>
<p>2．4．1 综述</p>
<p> 在Q-learning和DQN中，计算Q值（预期收益）都是必不可少的过程，同时也是限制算法应用的一大障碍。如果能够直接根据状态选择动作，就可以避免计算Q值带来的限制，这也就是Policy Gradient。</p>
<p>Policy Gradient算法是一种基于梯度优化的强化学习算法。它通过优化策略来最大化预期奖励，通常用于处理连续动作空间的问题。</p>
<p>Policy Gradient算法使用代表状态和行动的神经网络来决定策略。该算法通过多次采样，根据每个样本的回报来计算损失函数。然后使用梯度上升来更新代理策略网络的参数，以最小化损失。</p>
<p>2．4. 2 算法概述</p>
<p> 首先，初始化代理策略网络参数，然后根据当前策略生成多个样本路径。对每个样本路径计算其总收益，并将其作为回报。根据计算所得的回报，计算损失函数，并对其进行梯度计算。最后，使用梯度上升来更新代理策略网络的参数。</p>
<ol start="2">
<li><ol start="4">
<li>3 局限性</li>
</ol>
</li>
</ol>
<p> Policy Gradient算法通常需要多次采样以获得损失函数的近似值，因此计算效率相对较低。此外，Policy Gradient算法也容易受到过拟合和噪声干扰等问题的影响。为了解决这些问题，可以考虑采用正则化、调整学习率等方法来优化算法的性能。</p>
<p> 普通的Policy Gradient算法，只适合于解决规模较小的问题，比如让杆子竖起来。如果想应用到更复杂的问题上，就需要更复杂的一些方法，比如的Actor Critic，Asynchronous Advantage Actor-Critic (A3C)。</p>
<p>3前景展望</p>
<p>强化学习，作为人工智能领域中的一个重要分支，已经展示了其在许多领域的巨大潜力和前景。无论是自动驾驶汽车、智能家居系统、还是游戏AI，强化学习算法都在解决复杂的决策问题方面表现出色。然而，强化学习也面临着一系列挑战，其中最主要的包括样本效率问题、探索与利用的平衡、以及稳定性与收敛性等。</p>
<p>样本效率问题是强化学习算法在大量样本数据中进行学习的问题。为了获得最佳的学习效果，算法需要大量的样本数据进行训练，这无疑增加了算法的复杂性和运行成本。探索与利用的平衡问题则是指在探索新的可能性和利用已有知识之间找到一个平衡。过于探索可能导致算法失去方向，而过于利用则可能导致算法陷入局部最优解。</p>
<p>稳定性与收敛性也是强化学习算法面临的挑战。在面对复杂环境和决策空间时，强化学习算法可能会出现不稳定的情况，即在不同运行中得到的结果差异较大。而收敛性则是指算法能否在有限的步骤或时间内找到最优解。</p>
<p>为了解决这些问题，研究人员正在不断探索新的方法和算法。例如，一些研究人员正在尝试将强化学习与其他机器学习技术相结合，以提高算法的效率和稳定性。此外，还有一些研究人员正在探索新的优化策略，以更好地平衡探索和利用，以及提高算法的收敛速度和稳定性。</p>
<p>尽管存在这些挑战，但强化学习在许多领域的应用前景仍然非常广阔。它将继续推动自动化系统的革命，改善我们的生活和工作方式。同时，它不仅仅局限于传统机器人领域，还能扩展至金融、医疗、游戏和教育等多个领域，以改善决策和解决优化问题。</p>
<p>我们期待未来的研究人员能够克服强化学习的这些挑战，提出新的算法和技术，以改进其稳定性和可解释性。随着时间的推移，强化学习有望在不同领域带来更多创新和智能化解决方案，为未来的科技发展带来更广阔的可能性。无论是在自动驾驶汽车的安全性、智能家居系统的智能化水平、还是在游戏AI的表现上，强化学习都将为我们带来更多的惊喜和突破。</p>
<p>致谢 感谢老师对我的指导和鼓励，让我有机会深入了解强化学习这一领域。在完成这篇综述的过程中，我不仅学习了强化学习的基本概念、算法和应用，还对相关领域的研究进展有了更深入的了解。</p>
<p>同时，也感谢老师对我的信任和支持，让我有机会参与一些研究项目和学术活动，进一步拓宽了我的视野和知识面。</p>
<p>此外，我还要感谢我的同学们和朋友们，在我们的讨论和交流中，我得到了很多启发和思路。同时，也感谢他们对我的支持和鼓励，让我有信心面对学习和生活中的挑战。</p>
<p>再次感谢所有帮助和支持过我的人，我会继续努力学习和研究，不断提高自己的能力和水平。</p>
<p>参 考 文 献</p>
<p>[1] 强化学习入门：基本思想和经典算法, <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/466455380">https://zhuanlan.zhihu.com/p/466455380</a></p>
<p>[2] 强化学习入门, <a target="_blank" rel="noopener" href="https://blog.csdn.net/CltCj/article/details/119445005">https://blog.csdn.net/CltCj/article/details/119445005</a></p>
<p>[3] 【强化学习】Q-Learning算法详解, <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_30615903/article/details/80739243">https://blog.csdn.net/qq_30615903/article/details/80739243</a></p>
<p>[4] 如何理解策略梯度（Policy Gradient）算法, <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110881517">https://zhuanlan.zhihu.com/p/110881517</a></p>
<p>[5] 强化学习专栏 第七讲 策略梯度, <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/515290741">https://zhuanlan.zhihu.com/p/515290741</a></p>
<p>[6]Wang Yao, Luo Junren, Zhou Yanzhong, et al. Review and Analysis of Reinforcement Learning and Evolutionary Computing Methods for Policy Exploration [J&#x2F;OL]. Computer Science: 1-23 [2023-12-05]</p>
<p>(王尧,罗俊仁,周棪忠等.面向策略探索的强化学习与进化计算方法综述分析[J&#x2F;OL].计算机科学:1-23[2023-12-05].<a target="_blank" rel="noopener" href="http://kns.cnki.net/kcms/detail/50.1075.TP.20230925.1333.082.html">http://kns.cnki.net/kcms/detail/50.1075.TP.20230925.1333.082.html</a>.)</p>
<p>[7]Jiang Ying, Qi Yunsong. Overview of knowledge graph completion technology and applications for deep learning in artificial intelligence [J&#x2F;OL]. Computer Measurement and Control: 1-13 [2023-12-05]</p>
<p>(姜颖,祁云嵩.面向人工智能深度学习的知识图谱补全技术与应用综述[J&#x2F;OL].计算机测量与控制:1-13[2023-12-05].<a target="_blank" rel="noopener" href="http://kns.cnki.net/kcms/detail/11.4762.TP.20231017.1430.006.html">http://kns.cnki.net/kcms/detail/11.4762.TP.20231017.1430.006.html</a>.)</p>
<p>**<br>**</p>
<p><strong>Background</strong></p>
<p>**<br>**</p>
<p> Reinforcement learning has a wide range of applications, including robotics, game playing, autonomous driving, and recommendation systems. It has been used to develop agents that can play complex games like Go, at a superhuman level, navigate through complex environments, and optimize energy consumption in buildings.</p>
<p> There are several challenges associated with reinforcement learning, including the exploration-exploitation trade-off and generalization. Researchers have developed various techniques to address these challenges, such as policy gradients, and deep reinforcement learning. They are all such powerful and creative solutions that I could never imagine.</p>
<p>  Unfortunately, this article will not improve the solutions to the questions above. Neither did the article discover any valuable problems to be explored. As is said in the abstract part, the meaning of the article is just to help the people with really poor knowledge of reinforcement learning in addition to finishing the assignment and getting the credits</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-07T11:39:16.000Z" title="2024/5/7 19:39:16">2024-05-07</time>发表</span><span class="level-item"><time dateTime="2024-05-12T09:08:00.674Z" title="2024/5/12 17:08:00">2024-05-12</time>更新</span><span class="level-item">7 分钟读完 (大约976个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">WR740漏洞复现</a></p><div class="content"><h3 id="1-固件获取"><a href="#1-固件获取" class="headerlink" title="1.固件获取"></a>1.固件获取</h3><img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240507201809400.png" class="" title="image-20240507201809400">

<h3 id="2-binwalk解包"><a href="#2-binwalk解包" class="headerlink" title="2.binwalk解包"></a>2.binwalk解包</h3><h5 id="binwalk安装"><a href="#binwalk安装" class="headerlink" title="binwalk安装"></a>binwalk安装</h5><p>binwalk 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/ReFirmLabs/binwalk.git</span><br><span class="line">$ <span class="built_in">cd</span> binwalk</span><br><span class="line">$ sudo python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>sasquatch工具支持对 <strong>非标准的SquashFS格式的文件镜像</strong> 进行解压</p>
<p>sasquatch 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install build-essential liblzma-dev liblzo2-dev zlib1g-dev</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/devttys0/sasquatch.git</span><br><span class="line">$ <span class="built_in">cd</span> sasquatch</span><br><span class="line">$ ./build.sh</span><br></pre></td></tr></table></figure>

<p>sasquatch patch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> patches</span><br><span class="line">wget https://github.com/devttys0/sasquatch/files/7776843/M1-Kali.patch.txt</span><br><span class="line">patch patch0.txt M1-Kali.patch.txt</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">./build.sh</span><br></pre></td></tr></table></figure>



<h5 id="binwalk解包"><a href="#binwalk解包" class="headerlink" title="binwalk解包"></a>binwalk解包</h5><p><code>$ binwalk -Me wr740nv1_en_3_12_4_up.bin</code></p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240507201829426.png" class="" title="image-20240507201829426">

<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240507201846605.png" class="" title="image-20240507201846605">

<h3 id="3-firmwalker扫描"><a href="#3-firmwalker扫描" class="headerlink" title="3.firmwalker扫描"></a>3.firmwalker扫描</h3><p>获取firmwalker：<code>git clone https://github.com/craigz28/firmwalker.git</code></p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512124453141.png" class="" title="image-20240512124453141">

<p>路由器Web相关URL的格式为：&#x2F;web&#x2F;userRpm&#x2F;*</p>
<img src="/2024/05/07/WR740漏洞复现/image-20240512124702425.png"  alt="image-20240512124702425" style="zoom:50%;" />

<p>http服务器为httpd，且httpd中包含较多关键字符串，考虑对其进行分析</p>
<img src="/2024/05/07/WR740漏洞复现/image-20240512124803655.png"  alt="image-20240512124803655" style="zoom:50%;" />

<img src="/2024/05/07/WR740漏洞复现/image-20240512125003782.png"  alt="image-20240512125003782" style="zoom:50%;" />

<img src="/2024/05/07/WR740漏洞复现/image-20240512125036615.png"  alt="image-20240512125036615" style="zoom:50%;" />

<h3 id="4-httpd反编译分析"><a href="#4-httpd反编译分析" class="headerlink" title="4.httpd反编译分析"></a>4.httpd反编译分析</h3><p>使用IDA搜索passwd字符串，得到如下结果</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512125643206.png" class="" title="image-20240512125643206">

<p>第一个搜索结果仅有passwd，比较可疑，检查其引用。</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512125922013.png" class="" title="image-20240512125922013">

<p>在“passwd”附近还出现了“usr”字符串，以及“osteam”、“5up”两个意义不明的字符串，考虑将整个函数转换为C代码进行分析</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">DebugResultRpmHtm</span><span class="params">(undefined4 param_1)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  undefined4 *puVar1;</span><br><span class="line">  <span class="type">int</span> iVar2;</span><br><span class="line">  <span class="type">short</span> sVar8;</span><br><span class="line">  <span class="type">char</span> *pcVar3;</span><br><span class="line">  <span class="type">char</span> *pcVar4;</span><br><span class="line">  <span class="type">size_t</span> sVar5;</span><br><span class="line">  <span class="type">ssize_t</span> sVar6;</span><br><span class="line">  undefined4 *puVar7;</span><br><span class="line">  undefined4 uVar9;</span><br><span class="line">  undefined4 uVar10;</span><br><span class="line">  undefined4 uVar11;</span><br><span class="line">  undefined4 *puVar12;</span><br><span class="line">  undefined4 *puVar13;</span><br><span class="line">  <span class="type">int</span> iVar14;</span><br><span class="line">  <span class="type">int</span> iVar15;</span><br><span class="line">  undefined4 local_c30 [<span class="number">5</span>];</span><br><span class="line">  undefined2 local_c1c [<span class="number">1526</span>];</span><br><span class="line">  undefined4 *local_30;</span><br><span class="line">  undefined4 local_2c;</span><br><span class="line">  undefined4 local_28;</span><br><span class="line">  </span><br><span class="line">  local_2c = <span class="number">0x100</span>;</span><br><span class="line">  local_28 = <span class="number">0</span>;</span><br><span class="line">  local_30 = local_c30;</span><br><span class="line">  httpStatusSet(param_1,<span class="number">0</span>);</span><br><span class="line">  iVar14 = <span class="number">0</span>;</span><br><span class="line">  httpHeaderGenerate(param_1);</span><br><span class="line">  iVar15 = <span class="number">0</span>;</span><br><span class="line">  iVar2 = HttpAccessPermit(param_1);</span><br><span class="line">  <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">    sVar8 = HttpDenyPage(param_1);</span><br><span class="line">    <span class="keyword">goto</span> LAB_004816b4;</span><br><span class="line">  &#125;</span><br><span class="line">  local_c30[<span class="number">0</span>]._0_1_ = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (pty_started != <span class="number">0</span>) &#123;</span><br><span class="line">    pcVar3 = (<span class="type">char</span> *)httpGetEnv(param_1,&amp;DAT_0051717c);</span><br><span class="line">    <span class="keyword">if</span> (pcVar3 != (<span class="type">char</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">      iVar2 = <span class="built_in">strcmp</span>(pcVar3,<span class="string">&quot;exit&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (iVar2 != <span class="number">0</span>) &#123;</span><br><span class="line">        iVar2 = httpGetEnv(param_1,<span class="string">&quot;usr&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ((iVar2 != <span class="number">0</span>) &amp;&amp; (iVar2 = httpGetEnv(param_1,<span class="string">&quot;passwd&quot;</span>), iVar2 != <span class="number">0</span>)) &#123;</span><br><span class="line">          pcVar4 = (<span class="type">char</span> *)httpGetEnv(param_1,<span class="string">&quot;usr&quot;</span>);</span><br><span class="line">          iVar2 = <span class="built_in">strcmp</span>(pcVar4,<span class="string">&quot;osteam&quot;</span>);</span><br><span class="line">          <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">            pcVar4 = (<span class="type">char</span> *)httpGetEnv(param_1,<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">            iVar2 = <span class="built_in">strcmp</span>(pcVar4,<span class="string">&quot;5up&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) <span class="keyword">goto</span> LAB_004813f8;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        puVar7 = local_c30;</span><br><span class="line">        puVar1 = (undefined4 *)<span class="string">&quot;####User or Password not correct###\\n&quot;</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">          puVar13 = puVar1;</span><br><span class="line">          puVar12 = puVar7;</span><br><span class="line">          uVar9 = puVar13[<span class="number">1</span>];</span><br><span class="line">          uVar10 = puVar13[<span class="number">2</span>];</span><br><span class="line">          uVar11 = puVar13[<span class="number">3</span>];</span><br><span class="line">          *puVar12 = *puVar13;</span><br><span class="line">          puVar12[<span class="number">1</span>] = uVar9;</span><br><span class="line">          puVar12[<span class="number">2</span>] = uVar10;</span><br><span class="line">          puVar12[<span class="number">3</span>] = uVar11;</span><br><span class="line">          puVar7 = puVar12 + <span class="number">4</span>;</span><br><span class="line">          puVar1 = puVar13 + <span class="number">4</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (puVar13 + <span class="number">4</span> != (undefined4 *)<span class="number">0x5171c0</span>);</span><br><span class="line">        *(undefined2 *)(puVar12 + <span class="number">5</span>) = *(undefined2 *)(puVar13 + <span class="number">5</span>);</span><br><span class="line">        puVar12[<span class="number">4</span>] = <span class="number">0x2323235c</span>;</span><br><span class="line">        <span class="keyword">goto</span> LAB_00481600;</span><br><span class="line">      &#125;</span><br><span class="line">LAB_004813f8:</span><br><span class="line">      sVar5 = <span class="built_in">strlen</span>(pcVar3);</span><br><span class="line">      write(pty,pcVar3,sVar5);</span><br><span class="line">      pcVar4 = <span class="built_in">strstr</span>(pcVar3,<span class="string">&quot;ping&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ((pcVar4 != (<span class="type">char</span> *)<span class="number">0x0</span>) ||</span><br><span class="line">         ((pcVar4 = <span class="built_in">strstr</span>(pcVar3,<span class="string">&quot;cat&quot;</span>), pcVar4 != (<span class="type">char</span> *)<span class="number">0x0</span> &amp;&amp;</span><br><span class="line">          (pcVar3 = <span class="built_in">strchr</span>(pcVar3,<span class="number">0x26</span>), pcVar3 == (<span class="type">char</span> *)<span class="number">0x0</span>)))) &#123;</span><br><span class="line">        write(pty,<span class="string">&quot;&amp;&quot;</span>,<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      write(pty,&amp;DAT_00512b9c,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    taskDelay(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      sVar6 = read(pty,(<span class="type">void</span> *)((<span class="type">int</span>)local_c30 + iVar14),<span class="number">0x10</span>);</span><br><span class="line">      iVar15 = iVar15 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (sVar6 != <span class="number">0x10</span>) <span class="keyword">goto</span> LAB_00481574;</span><br><span class="line">      iVar14 = iVar14 + <span class="number">0x10</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (iVar15 != <span class="number">0xa8</span>);</span><br><span class="line">    sVar6 = <span class="number">0</span>;</span><br><span class="line">LAB_00481574:</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> &lt; sVar6 + <span class="number">1U</span>) &#123;</span><br><span class="line">      iVar14 = sVar6 + iVar14;</span><br><span class="line">    &#125;</span><br><span class="line">    *(undefined *)((<span class="type">int</span>)local_c30 + iVar14) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( <span class="literal">true</span> ) &#123;</span><br><span class="line">      puVar7 = (undefined4 *)<span class="built_in">strstr</span>((<span class="type">char</span> *)local_c30,<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (puVar7 == (undefined4 *)<span class="number">0x0</span>) <span class="keyword">break</span>;</span><br><span class="line">      sVar5 = <span class="built_in">strlen</span>((<span class="type">char</span> *)((<span class="type">int</span>)puVar7 + <span class="number">2</span>));</span><br><span class="line">      memmove(puVar7 + <span class="number">1</span>,(<span class="type">char</span> *)((<span class="type">int</span>)puVar7 + <span class="number">2</span>),sVar5 + <span class="number">1</span>);</span><br><span class="line">      *puVar7 = <span class="number">0x5c725c6e</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LAB_00481600:</span><br><span class="line">  httpPrintf(param_1,</span><br><span class="line">             <span class="string">&quot;&lt;SCRIPT language=\&quot;javascript\&quot; type=\&quot;text/javascript\&quot;&gt;\nvar %s = new Array(\n&quot;</span>,</span><br><span class="line">             <span class="string">&quot;cmdResult&quot;</span>);</span><br><span class="line">  httpPrintf(param_1,<span class="string">&quot;\&quot;%s\&quot;,\n&quot;</span>,local_c30);</span><br><span class="line">  httpPrintf(param_1,<span class="string">&quot;0,0 );\n&lt;/SCRIPT&gt;\n&quot;</span>);</span><br><span class="line">  HttpWebV4Head(param_1,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">  iVar14 = httpRpmFsA(param_1,<span class="string">&quot;/userRpm/DebugResult.htm&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (iVar14 == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  sVar8 = HttpErrorPage(param_1,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">LAB_004816b4:</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)sVar8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意到此函数将http请求中usr、passwd字段分别与“osteam”、“5up”比较，并执行http中cmd字段的命令</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512131624296.png" class="" title="image-20240512131624296">

<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512131217976.png" class="" title="image-20240512131217976">

<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512131249986.png" class="" title="image-20240512131249986">

<p>通过write(pty,cmd,strlen(cmd))来模拟执行命令。伪终端(pseudo terminal，有时也被称为 pty)是指伪终端 master 和伪终端 slave 这一对字符设备。其中的 slave 对应 &#x2F;dev&#x2F;pts&#x2F; 目录下的一个文件，而 master 则在内存中标识为一个文件描述符(fd)。伪终端由终端模拟器提供，终端模拟器是一个运行在用户态的应用程序。可通过写pty文件执行指令。</p>
<p>检查该函数调用情况，发现url绑定</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512132246025.png" class="" title="image-20240512132246025">

<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512132802445.png" class="" title="image-20240512132802445">

<h3 id="5-模拟验证"><a href="#5-模拟验证" class="headerlink" title="5.模拟验证"></a>5.模拟验证</h3><h5 id="FirmAE安装"><a href="#FirmAE安装" class="headerlink" title="FirmAE安装"></a>FirmAE安装</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --recursive https://github.com/pr0v3rbs/FirmAE</span><br><span class="line">$ ./download.sh</span><br><span class="line">$ ./install.sh</span><br></pre></td></tr></table></figure>

<p>由于涉及分区挂载操作，FirmAE不能在WSL下运行。</p>
<h5 id="模拟"><a href="#模拟" class="headerlink" title="模拟"></a>模拟</h5><p>先检查能否模拟</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512164854223.png" class="" title="image-20240512164854223">

<p>然后进行模拟</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512165744402.png" class="" title="image-20240512165744402">

<p>访问前面发现的url，根据提示输入默认账号密码，发现可以执行命令</p>
<img src="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240512170419376.png" class="" title="image-20240512170419376">
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-09T01:47:58.538Z" title="2024/2/9 09:47:58">2024-02-09</time>发表</span><span class="level-item"><time dateTime="2024-02-09T01:47:58.538Z" title="2024/2/9 09:47:58">2024-02-09</time>更新</span><span class="level-item">1 分钟读完 (大约123个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/09/hello-world/">Hello World</a></p><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/1.png" alt="Rye Song"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Rye Song</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Qingdao/Chengdu</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/rain1201" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/rain1201"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Bilibili" href="https://space.bilibili.com/454747202"><i class="fa-brands fa-bilibili"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-09T08:26:48.000Z">2024-05-09</time></p><p class="title"><a href="/2024/05/09/%E5%89%AA%E5%88%80%E7%9F%B3%E5%A4%B4%E5%B8%83dapp%E5%BC%80%E5%8F%91/">剪刀石头布dapp开发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-09T08:24:43.000Z">2024-05-09</time></p><p class="title"><a href="/2024/05/09/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%BB%BC%E8%BF%B0/">强化学习综述</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-07T11:39:16.000Z">2024-05-07</time></p><p class="title"><a href="/2024/05/07/WR740%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">WR740漏洞复现</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-09T01:47:58.538Z">2024-02-09</time></p><p class="title"><a href="/2024/02/09/hello-world/">Hello World</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="aBlog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Rye Song</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2024</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>